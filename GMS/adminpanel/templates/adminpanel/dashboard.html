{% extends "customer_base.html" %}
{% load static %}

{% block page_title %}Dashboard{% endblock %}
{% block page_subtitle %}Let's check your garage today{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'adminpanel.css' %}">
{% endblock %}

{% block content %}
<div class="ap-page-center">
  <div class="ap-card-large">

    <!-- Top Stats -->
    <div class="ap-stats-grid">
      <div class="ap-stat-card">
        <div class="ap-stat-top">
          <div>
            <div class="ap-stat-value">{{ total_items }}</div>
            <div class="ap-stat-label">Total Items</div>
          </div>
          <div class="ap-stat-icon ap-icon-info">üì¶</div>
        </div>
      </div>

      <div class="ap-stat-card">
        <div class="ap-stat-top">
          <div>
            <div class="ap-stat-value">{{ low_stock_items }}</div>
            <div class="ap-stat-label">Low Stock Items</div>
          </div>
          <div class="ap-stat-icon ap-icon-warning">‚ö†</div>
        </div>
      </div>

      <div class="ap-stat-card">
        <div class="ap-stat-top">
          <div>
            <div class="ap-stat-value">{{ out_of_stock_items }}</div>
            <div class="ap-stat-label">Out of Stock</div>
          </div>
          <div class="ap-stat-icon ap-icon-danger">‚õî</div>
        </div>
      </div>

      <div class="ap-stat-card">
        <div class="ap-stat-top">
          <div>
            <div class="ap-stat-value">{{ total_jobs }}</div>
            <div class="ap-stat-label">Active Jobs</div>
          </div>
          <div class="ap-stat-icon ap-icon-success">üõ†</div>
        </div>
      </div>
    </div>

    {% if out_of_stock_items > 0 %}
      <div class="ap-alert ap-alert-danger ap-mt-18">
        <div class="ap-alert-icon">!</div>
        <div class="ap-alert-content">
          <h4 class="ap-alert-title">
            {{ out_of_stock_items }} item{{ out_of_stock_items|pluralize }} out of stock!
          </h4>
          <p class="ap-alert-text">Immediate reorder recommended to avoid service delays.</p>
        </div>
      </div>
    {% endif %}

    <!-- Recent Inventory -->
    <div class="ap-section ap-mt-18">
      <div class="ap-section-header">
        <h3 class="ap-section-title">Recent Inventory</h3>
        <a href="{% url 'adminpanel:inventory' %}" class="ap-btn ap-btn-outline">View All</a>
      </div>

      <div class="ap-table-container">
        <table class="ap-table-modern ap-table-hover">
          <thead>
            <tr>
              <th>Part Name</th>
              <th>Price</th>
              <th>Quantity</th>
              <th>Stock Status</th>
              <th class="ap-text-right">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for item in recent_inventory %}
              <tr>
                <td>{{ item.name }}</td>
                <td>{{ item.price }}</td>
                <td>{{ item.quantity }}</td>
                <td>
                  <span class="ap-badge ap-badge-{{ item.stock_status_color }}">{{ item.stock_status_display }}</span>
                </td>
                <td class="ap-text-right">
                  <a href="{% url 'adminpanel:edit_inventory_item' item.part_id %}" class="ap-btn ap-btn-outline ap-btn-sm">
                    Edit
                  </a>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="5" class="ap-empty">
                  No inventory items found.
                  <a href="{% url 'adminpanel:add_inventory_item' %}" class="ap-inline-link">Add your first item</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Recent Jobs -->
    <div class="ap-section ap-mt-18">
      <div class="ap-section-header">
        <h3 class="ap-section-title">Recent Jobs</h3>
        <a href="{% url 'adminpanel:jobs' %}" class="ap-btn ap-btn-outline">View All</a>
      </div>

      <div class="ap-table-container">
        <table class="ap-table-modern ap-table-hover">
          <thead>
            <tr>
              <th>Work ID</th>
              <th>Assigned To</th>
              <th>Status</th>
              <th>Appointment</th>
              <th>Created</th>
            </tr>
          </thead>

          <tbody>
            {% for job in recent_jobs %}
              <tr>
                <td>#{{ job.work_list_id }}</td>
                <td>{{ job.user.get_full_name|default:job.user.username }}</td>
                <td>
                  {% if job.job_status == 'completed' %}
                    <span class="ap-badge ap-badge-success">Completed</span>
                  {% elif job.job_status == 'in_progress' %}
                    <span class="ap-badge ap-badge-warning">In Progress</span>
                  {% elif job.job_status == 'assigned' %}
                    <span class="ap-badge ap-badge-danger">Assigned</span>
                  {% else %}
                    <span class="ap-badge ap-badge-info">{{ job.job_status|title }}</span>
                  {% endif %}
                </td>
                <td>#{{ job.appointment.appointment_id }}</td>
                <td>{{ job.created_at|date:"M d, Y" }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="5" class="ap-empty">No jobs found.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Bottom Stats -->
    <div class="ap-stats-grid ap-mt-18">
      <div class="ap-stat-card">
        <div class="ap-stat-top">
          <div>
            <div class="ap-stat-value">{{ total_customers }}</div>
            <div class="ap-stat-label">Total Customers</div>
          </div>
          <div class="ap-stat-icon ap-icon-success">üë•</div>
        </div>
        <div class="ap-stat-sub">{{ new_customers_today }} new today</div>
      </div>

      <div class="ap-stat-card">
        <div class="ap-stat-top">
          <div>
            <div class="ap-stat-value">{{ pending_jobs }}</div>
            <div class="ap-stat-label">Pending Jobs</div>
          </div>
          <div class="ap-stat-icon ap-icon-warning">‚è≥</div>
        </div>
      </div>

      <div class="ap-stat-card">
        <div class="ap-stat-top">
          <div>
            <div class="ap-stat-value">{{ in_progress_jobs }}</div>
            <div class="ap-stat-label">Jobs in Progress</div>
          </div>
          <div class="ap-stat-icon ap-icon-info">üõ†</div>
        </div>
      </div>

      <div class="ap-stat-card">
        <div class="ap-stat-top">
          <div>
            <div class="ap-stat-value">{{ pending_appointments }}</div>
            <div class="ap-stat-label">Pending Appointments</div>
          </div>
          <div class="ap-stat-icon ap-icon-danger">üìÖ</div>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}