{% extends "customer_base.html" %}
{% load static %}

{% block page_title %}Add Part{% endblock %}
{% block page_subtitle %}Add new part to inventory{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'adminpanel.css' %}">
{% endblock %}

{% block content %}
<div class="ap-container">
  <div class="ap-card">

    <!-- Header -->
    <div class="ap-header">
      <h3 class="ap-title">Add New Part</h3>
      <a href="{% url 'adminpanel:inventory' %}" class="ap-btn ap-btn-outline">
        ‚Üê Back to Inventory
      </a>
    </div>

    <div class="ap-form-card">
      <form method="post" id="addItemForm" enctype="multipart/form-data" onsubmit="return validateForm('addItemForm')">
        {% csrf_token %}

        {% if form.errors %}
        <div class="ap-alert ap-alert-warning">
          <div class="ap-alert-icon">!</div>
          <div class="ap-alert-content">
            <h4 class="ap-alert-title">Please correct the errors below</h4>
          </div>
        </div>
        {% endif %}

        <!-- Part Name -->
        <div class="ap-form-group">
          <label class="ap-label" for="id_name">Part Name <span class="ap-required">*</span></label>
          {{ form.name }}
          {% if form.name.errors %}
            <div class="ap-error">{{ form.name.errors }}</div>
          {% endif %}
        </div>

        <!-- Compatible Model -->
        <div class="ap-form-group">
          <label class="ap-label" for="id_compatible_model">Compatible Model</label>
          {{ form.compatible_model }}
        </div>

        <!-- Price + Quantity -->
        <div class="ap-grid ap-grid-2">
          <div class="ap-form-group">
            <label class="ap-label" for="id_price">Price (Nrs) <span class="ap-required">*</span></label>
            {{ form.price }}
            {% if form.price.errors %}
              <div class="ap-error">{{ form.price.errors }}</div>
            {% endif %}
          </div>

          <div class="ap-form-group">
            <label class="ap-label" for="id_quantity">Quantity <span class="ap-required">*</span></label>
            {{ form.quantity }}
            {% if form.quantity.errors %}
              <div class="ap-error">{{ form.quantity.errors }}</div>
            {% endif %}
          </div>
        </div>

        <!-- Min Stock + Category -->
        <div class="ap-grid ap-grid-2">
          <div class="ap-form-group">
            <label class="ap-label" for="id_min_stock_level">Minimum Stock Level</label>
            {{ form.min_stock_level }}
            <small class="ap-help">Alert when stock falls below this level</small>
          </div>

          <div class="ap-form-group">
            <label class="ap-label" for="id_category">Category</label>
            {{ form.category }}
          </div>
        </div>

        <!-- Brand -->
        <div class="ap-grid ap-grid-2">
          <div class="ap-form-group">
            <label class="ap-label" for="id_brand">Brand</label>
            {{ form.brand }}
          </div>
        </div>

        <!-- Image -->
        <div class="ap-form-group">
          <label class="ap-label" for="id_image">Part Image</label>
          {{ form.image }}
          <small class="ap-help">Upload a clear image of the part (optional)</small>
        </div>

        <!-- Description -->
        <div class="ap-form-group">
          <label class="ap-label" for="id_description">Description</label>
          {{ form.description }}
          <small class="ap-help">Add details about the part, specifications, etc.</small>
        </div>

        <!-- Actions -->
        <div class="ap-actions">
          <button type="submit" class="ap-btn ap-btn-primary">
            Add Part
          </button>
          <a href="{% url 'adminpanel:inventory' %}" class="ap-btn ap-btn-outline">Cancel</a>
        </div>

      </form>
    </div>

  </div>
</div>

<script>
  // Apply consistent custom input styling to Django-rendered fields
  document.querySelectorAll('#addItemForm input, #addItemForm select, #addItemForm textarea').forEach(field => {
    // Skip csrf token hidden input
    if (field.type === "hidden") return;

    // file input gets same base style
    field.classList.add('ap-input');

    // Make textarea nicer
    if (field.tagName.toLowerCase() === 'textarea') {
      field.classList.add('ap-textarea');
    }
  });

  // Simple validation highlight (required only)
  function validateForm(formId) {
    const form = document.getElementById(formId);
    const requiredFields = form.querySelectorAll('[required]');
    let ok = true;

    requiredFields.forEach(field => {
      if (!field.value || !field.value.trim()) {
        field.classList.add('ap-input-error');
        ok = false;
      } else {
        field.classList.remove('ap-input-error');
      }
    });

    return ok;
  }
</script>
{% endblock %}