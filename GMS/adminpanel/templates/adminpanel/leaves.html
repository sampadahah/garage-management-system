{% extends "customer_base.html" %}
{% load static %}

{% block page_title %}Leaves{% endblock %}
{% block page_subtitle %}Manage staff/mechanic leave requests{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'adminpanel.css' %}">
{% endblock %}

{% block content %}
<div class="ap-page-center">
  <div class="ap-card-large">

    <!-- Header -->
    <div class="ap-header">
      <h2 class="ap-title-large">Leave Applications</h2>
    </div>

    <!-- Table -->
    <div class="ap-table-container">
      <table class="ap-table-modern ap-table-hover">
        <thead>
          <tr>
            <th>ID</th>
            <th>Employee</th>
            <th>Type</th>
            <th>From</th>
            <th>To</th>
            <th>Status</th>
            <th>Applied At</th>
            <th class="ap-text-right">Action</th>
          </tr>
        </thead>

        <tbody>
          {% for l in leaves %}
          <tr>
            <td>#{{ l.leave_id }}</td>
            <td>{{ l.user.get_full_name|default:l.user.username }}</td>
            <td>{{ l.leave_type }}</td>
            <td>{{ l.start_date|date:"M d, Y" }}</td>
            <td>{{ l.end_date|date:"M d, Y" }}</td>

            <td>
              {% if l.status == "approved" %}
                <span class="ap-badge ap-badge-success">Approved</span>
              {% elif l.status == "rejected" %}
                <span class="ap-badge ap-badge-danger">Rejected</span>
              {% else %}
                <span class="ap-badge ap-badge-warning">Pending</span>
              {% endif %}
            </td>

            <td>{{ l.applied_at|date:"M d, Y H:i" }}</td>

            <td class="ap-text-right">
              {% if l.status == "pending" %}
                <div class="ap-action-buttons">
                  <a class="ap-btn ap-btn-success ap-btn-sm"
                     href="{% url 'adminpanel:decide_leave' l.leave_id 'approve' %}">
                    Approve
                  </a>

                  <a class="ap-btn ap-btn-danger ap-btn-sm"
                     href="{% url 'adminpanel:decide_leave' l.leave_id 'reject' %}">
                    Reject
                  </a>
                </div>
              {% else %}
                -
              {% endif %}
            </td>
          </tr>

          {% empty %}
          <tr>
            <td colspan="8" class="ap-empty">No leave applications found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>
{% endblock %}