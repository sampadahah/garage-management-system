{% extends "customer_base.html" %}
{% load static %}

{% block page_title %}Inventory{% endblock %}
{% block page_subtitle %}Let's check your inventory today{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'adminpanel.css' %}">
{% endblock %}

{% block content %}
<div class="ap-page-center">
  <div class="ap-card-large">

    {% if out_of_stock_items > 0 %}
      <div class="ap-alert ap-alert-danger ap-mb-20">
        <div class="ap-alert-icon">!</div>
        <div class="ap-alert-content">
          <h4 class="ap-alert-title">
            {{ out_of_stock_items }} item{{ out_of_stock_items|pluralize }} out of stock!
          </h4>
          <p class="ap-alert-text">Immediate reorder recommended to avoid service delays.</p>
        </div>
      </div>
    {% endif %}

    <!-- Header -->
    <div class="ap-header ap-header-wrap">
      <div>
        <h2 class="ap-title-large">Inventory Items</h2>
      </div>

      <div class="ap-toolbar">
        <form method="get" class="ap-search">
          <input
            type="text"
            name="search"
            value="{{ search_query }}"
            placeholder="Search items..."
            class="ap-input ap-search-input"
          />

          <button type="submit" class="ap-btn ap-btn-outline">Search</button>

          {% if search_query %}
            <a href="{% url 'adminpanel:inventory' %}" class="ap-btn ap-btn-outline">Clear</a>
          {% endif %}
        </form>

        <a href="{% url 'adminpanel:add_inventory_item' %}" class="ap-btn ap-btn-primary">
          + Add New Part
        </a>
      </div>
    </div>

    <!-- Table -->
    <div class="ap-table-container">
      <table class="ap-table-modern ap-table-hover">
        <thead>
          <tr>
            <th>Part Name</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Min Stock</th>
            <th>Category</th>
            <th>Stock Status</th>
            <th class="ap-text-right">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for item in inventory_items %}
            <tr>
              <td>
                <a href="{% url 'adminpanel:item_details' item.part_id %}" class="ap-item-link">
                  <strong>{{ item.name }}</strong>
                  {% if item.compatible_model %}
                    <br />
                    <small class="ap-muted">Compatible: {{ item.compatible_model }}</small>
                  {% endif %}
                </a>
              </td>

              <td>{{ item.price }}</td>
              <td>{{ item.quantity }}</td>
              <td>{{ item.min_stock_level }}</td>

              <td>
                {% if item.category %}
                  {{ item.category.category_name }}
                {% else %}
                  -
                {% endif %}
              </td>

              <td>
                <span class="ap-badge ap-badge-{{ item.stock_status_color }}">
                  {{ item.stock_status_display }}
                </span>
              </td>

              <td class="ap-text-right">
                <div class="ap-action-buttons">
                  <a href="{% url 'adminpanel:edit_inventory_item' item.part_id %}"
                     class="ap-icon-btn ap-icon-btn-outline"
                     title="Edit">
                    âœŽ
                  </a>

                  <a href="{% url 'adminpanel:delete_inventory_item' item.part_id %}"
                     class="ap-icon-btn ap-icon-btn-danger"
                     title="Delete"
                     data-delete-link="1">
                    ðŸ—‘
                  </a>
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7" class="ap-empty">
                {% if search_query %}
                  No items found matching "{{ search_query }}"
                {% else %}
                  No inventory items found.
                  <a href="{% url 'adminpanel:add_inventory_item' %}" class="ap-inline-link">Add your first item</a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    {% if inventory_items.has_other_pages %}
      <div class="ap-pagination">
        {% if inventory_items.has_previous %}
          <a class="ap-page-link"
             href="?page={{ inventory_items.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">
            â€¹ Previous
          </a>
        {% endif %}

        {% for num in inventory_items.paginator.page_range %}
          {% if inventory_items.number == num %}
            <span class="ap-page-link ap-page-link-active">{{ num }}</span>
          {% elif num > inventory_items.number|add:'-3' and num < inventory_items.number|add:'3' %}
            <a class="ap-page-link"
               href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}">
              {{ num }}
            </a>
          {% endif %}
        {% endfor %}

        {% if inventory_items.has_next %}
          <a class="ap-page-link"
             href="?page={{ inventory_items.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">
            Next â€º
          </a>
        {% endif %}
      </div>
    {% endif %}

  </div>
</div>

<script>
  // Confirm delete action (only for delete buttons)
  document.querySelectorAll('[data-delete-link="1"]').forEach((link) => {
    link.addEventListener('click', function (e) {
      if (!confirm('Are you sure you want to delete this inventory item?')) {
        e.preventDefault();
      }
    });
  });
</script>
{% endblock %}